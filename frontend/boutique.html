<!DOCTYPE html>
<html lang="fr">
<head>
  <script>
    fetch('head.html')
      .then(response => response.text())
      .then(data => {
        document.head.innerHTML = data + document.head.innerHTML;
        document.title = "Mini Palettes Roses - Boutique"; // garde ton titre sp√©cifique
      })
      .catch(err => console.error('Erreur chargement head:', err));
  </script>
  <style>
#galerie-produits {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  justify-content: center;
}

.produit {
  width: 200px;
  border: 1px solid #eee;
  border-radius: 15px;
  padding: 1rem;
  text-align: center;
  background: #fff0f6;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
  transition: transform 0.2s ease;
}
.produit:hover {
  transform: scale(1.02);
}

.produit img {
  width: 100%;
  border-radius: 12px;
}

.lien-produit {
  color: inherit;
  text-decoration: none;
  display: block;
}

.btn-ajouter {
  margin-top: 0.7rem;
  padding: 0.6rem 1rem;
  background-color: var(--rose-fonc√©, #e91e63);
  border: 2px solid transparent;
  color: white;
  border-radius: 30px;
  cursor: pointer;
  font-weight: bold;
  width: 100%;
  transition: background-color 0.3s ease, transform 0.2s ease;
}
.btn-ajouter:hover {
  background-color: #c2185b;
  transform: scale(1.03);
}

.btn-supprimer {
  background-color: white;
  border: 2px solid #c2185b;
  color: #c2185b;
  font-size: 0.85rem;
  font-weight: bold;
  padding: 0.3rem 0.7rem;
  border-radius: 20px;
  cursor: pointer;
  transition: background-color 0.3s ease, color 0.3s ease;
}
.btn-supprimer:hover {
  background-color: #c2185b;
  color: white;
}

  </style>
</head>

<body>
<div class="bandeau-taxes">
  TOUS LES PRIX INCLUENT LES TAXES
</div>

<header class="banniere">
  <div class="header-container">
    <div class="logo-texte">
      <a href="index.html">
        <img src="images/MPR_logo_FINAL-vectorise.png" alt="Logo Mini Palettes Roses" class="logo-site">
      </a>
      <div class="texte-site">
        <h1>Mini-palettes roses</h1>
        <p>La boutique des futures Palettes Roses!</p>
      </div>
    </div>

    <nav class="menu-nav">
      <a href="index.html" class="nav-link">Accueil</a>
      <a href="a-propos.html" class="nav-link">√Ä propos</a>
      <a href="contact.html" class="nav-link">Contact</a>
    </nav>
  </div>
</header>

<button id="btn-panier" title="Voir le panier">üõí Panier (<span id="nb-items">0</span>)</button>

<div id="sidebar-panier" class="sidebar-closed">
  <button id="btn-fermer-panier">‚úñ</button>
  <h2>Ton panier</h2>
  <ul id="liste-panier"></ul>
  <p><strong>Total : <span id="total">0.00</span> $</strong></p>
  <button id="payer">Proc√©der au paiement</button>
</div>

<main>
  <section id="galerie-produits" class="galerie"></section>
</main>

<script>
  let panier = JSON.parse(localStorage.getItem('panier')) || [];

  const API_BASE_URL = window.location.origin.includes('localhost')
  ? 'http://localhost:3000'
  : 'https://www.minipalettes.ca';

  function majNbItems() {
    document.getElementById('nb-items').textContent = panier.length;
  }

  function afficherPanier() {
    const liste = document.getElementById('liste-panier');
    liste.innerHTML = '';
    let total = 0;

    panier.forEach((item, index) => {
      total += item.prix;
      const li = document.createElement('li');
      li.innerHTML = `${item.nom} (${item.taille || "?"}, ${item.personnalisation || "aucune"}) - ${item.prix.toFixed(2)} $ <button class="btn-supprimer" data-index="${index}" title="Supprimer">üóëÔ∏è Supprimer</button>`;
      liste.appendChild(li);
    });

    document.getElementById('total').textContent = total.toFixed(2);
    majNbItems();

    document.querySelectorAll('.btn-supprimer').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const i = parseInt(e.target.dataset.index);
        panier.splice(i, 1);
        localStorage.setItem('panier', JSON.stringify(panier));
        afficherPanier();
      });
    });
  }

  document.getElementById('btn-panier').addEventListener('click', () => {
    document.getElementById('sidebar-panier').classList.toggle('open');
  });

  document.getElementById('btn-fermer-panier').addEventListener('click', () => {
    document.getElementById('sidebar-panier').classList.remove('open');
  });

  fetch('produits.json')
    .then(res => res.json())
    .then(produits => {
      const container = document.getElementById('galerie-produits');
      container.innerHTML = '';

      for (const idProduit in produits) {
        const p = produits[idProduit];
        const divProduit = document.createElement('div');
        divProduit.className = 'produit';
        divProduit.dataset.nom = p.nom;
        divProduit.dataset.prix = p.prix;
        divProduit.innerHTML = `
          <a href="produit.html?id=${idProduit}" class="lien-produit">
            <img src="${p.image}" alt="${p.nom}" />
            <h3>${p.nom}</h3>
            <p>${p.prix.toFixed(2)} $</p>
          </a>
        `;
        container.appendChild(divProduit);
      }
    });

  afficherPanier();

  // Paiement via Stripe Checkout
  document.getElementById('payer').addEventListener('click', async () => {
    if (panier.length === 0) {
      alert("Ton panier est vide !");
      return;
    }
    try {
      const response = await fetch(`${API_BASE_URL}/create-checkout-session`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ panier }),
});
      const data = await response.json();

      if (data.id) {
  // On sauvegarde le panier temporairement pour success.html
  sessionStorage.setItem('dernierPanier', JSON.stringify(panier));

  const stripe = Stripe('pk_test_51RjVtFPtAYsb0tTKFaXBb3U96XQePm5nInGkVMaubkiqz9tWXLyv2qqQLfLsFQRxUwH2jHzZBp9ZLhA9TR2k1N0a007kRZOPEr');
  await stripe.redirectToCheckout({ sessionId: data.id });
} else {
  alert('Erreur lors de la cr√©ation de la session de paiement.');
}
    } catch (error) {
      console.error('Erreur paiement:', error);
      alert('Erreur lors du paiement. Veuillez contacter la personne en charge.');
    }
  });
</script>

<div id="footer-container"></div>

<script>
  fetch('footer.html')
    .then(response => response.text())
    .then(data => {
      document.getElementById('footer-container').outerHTML = data;
    });
</script>

</body>
</html>
