<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini Palettes Roses - Boutique</title>
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://js.stripe.com/v3/"></script>
  <link rel="icon" type="image/x-icon" href="images/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="images/favicon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="images/favicon-512.png">
  <link rel="apple-touch-icon" sizes="180x180" href="images/favicon-192.png">
  <meta name="theme-color" content="#e91e63">
  <style>
    /* Styles galerie et produits */
    #galerie-produits {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
    }
    .produit {
      width: 200px;
      border: 1px solid #eee;
      border-radius: 15px;
      padding: 1rem;
      text-align: center;
      background: #fff0f6;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      transition: transform 0.2s ease;
    }
    .produit:hover { transform: scale(1.02); }
    .produit img { width: 100%; border-radius: 12px; }
    .lien-produit { color: inherit; text-decoration: none; display: block; }
    .btn-supprimer {
      background-color: white;
      border: 2px solid #c2185b;
      color: #c2185b;
      font-size: 0.85rem;
      font-weight: bold;
      padding: 0.3rem 0.7rem;
      border-radius: 20px;
      cursor: pointer;
      transition: background-color 0.3s ease, color 0.3s ease;
    }
    .btn-supprimer:hover { background-color: #c2185b; color: white; }
    .fade-in { animation: fadeIn 1s ease forwards; }
    @keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
  </style>
</head>

<body>
<!-- Bandeau cookies -->
<div id="cookie-banner" class="cookie-banner">
  <p>
    Nous utilisons des cookies conform√©ment √† la Loi 25 sur la protection des renseignements personnels des citoyens du Qu√©bec.
    <a href="politique.html" class="cookie-link">En savoir plus</a>
  </p>
  <div class="cookie-buttons">
    <button id="accept-cookies" class="btn-cookie">Accepter</button>
    <button id="refuse-cookies" class="btn-cookie refuse">Seulement les t√©moins n√©cessaires</button>
  </div>
</div>
<script src="cookies.js"></script>

<div class="bandeau-taxes">TOUS LES PRIX INCLUENT LES TAXES</div>

<header class="banniere">
  <div class="header-container">
    <div class="logo-texte">
      <a href="index.html"><img src="images/MPR_logo_FINAL-vectorise.png" alt="Logo Mini Palettes Roses" class="logo-site"></a>
      <div class="texte-site">
        <h1>Mini-palettes roses</h1>
        <p>La boutique des futures Palettes Roses!</p>
      </div>
    </div>
    <nav class="menu-nav">
      <a href="index.html" class="nav-link">Accueil</a>
      <a href="a-propos.html" class="nav-link">√Ä propos</a>
      <a href="inscription.html" class="nav-link">Inscription</a>
      <a href="contact.html" class="nav-link">Contact</a>
    </nav>
  </div>
</header>

<button id="btn-panier" title="Voir le panier">üõí  (<span id="nb-items">0</span>)</button>

<div id="sidebar-panier" class="sidebar-closed">
  <button id="btn-fermer-panier">‚úñ</button>
  <h2>Ton panier</h2>
  <ul id="liste-panier"></ul>
  <p><strong>Total : <span id="total">0.00</span> $</strong></p>
  <button id="payer">Proc√©der au paiement</button>
</div>

<main class="fade-in">
  <section id="galerie-produits" class="galerie"></section>
</main>

<script>
let panier = JSON.parse(localStorage.getItem('panier')) || [];

function majNbItems() {
  const totalArticles = panier.reduce((acc,item)=>acc+(Number(item.quantite)||0),0);
  document.getElementById('nb-items').textContent = totalArticles;
}

function afficherPanier() {
  const liste = document.getElementById('liste-panier');
  liste.innerHTML = '';
  let total = 0;
  panier = panier.map(item=>{
    const quant = Number(item.quantite)||1;
    const prixUnitaire = (item.prixUnitaire!==undefined)?Number(item.prixUnitaire):Number(item.prix)/quant;
    return {...item, quantite:quant, prixUnitaire:prixUnitaire, prix:prixUnitaire*quant};
  });

  if (!panier.length) {
    liste.innerHTML='<li style="text-align:center;color:#888;">Ton panier est vide üõçÔ∏è</li>';
    document.getElementById('total').textContent='0.00';
    majNbItems();
    return;
  }

  panier.forEach((item,index)=>{
    total+=item.prix;
    const li=document.createElement('li');
    li.className='ligne-panier';
    li.innerHTML=`
      <div class="ligne-left">
        <div class="nom-produit"><strong>${item.nom}</strong></div>
        <div style="font-size:0.85rem;color:#666;">
          ${item.taille||''} ${item.personnalisation? '‚Ä¢ '+item.personnalisation : ''}
        </div>
      </div>
      <div class="ligne-right">
        <div class="quantite-controls">
          <button class="btn-moins" data-index="${index}">‚ûñ</button>
          <input type="number" class="qte-input" data-index="${index}" value="${item.quantite}" min="1"/>
          <button class="btn-plus" data-index="${index}">‚ûï</button>
        </div>
        <div class="prix-item">${item.prix.toFixed(2)} $</div>
        <button class="btn-supprimer" data-index="${index}">üóëÔ∏è</button>
      </div>
    `;
    liste.appendChild(li);
  });

  // Boutons
  document.querySelectorAll('.btn-plus').forEach(btn=>{
    btn.addEventListener('click',e=>{
      const i=Number(e.currentTarget.dataset.index);
      if(!Number.isFinite(i)) return;
      panier[i].quantite++; panier[i].prix=panier[i].quantite*panier[i].prixUnitaire;
      localStorage.setItem('panier',JSON.stringify(panier));
      afficherPanier();
    });
  });
  document.querySelectorAll('.btn-moins').forEach(btn=>{
    btn.addEventListener('click',e=>{
      const i=Number(e.currentTarget.dataset.index);
      if(!Number.isFinite(i)) return;
      if(panier[i].quantite>1){ panier[i].quantite--; panier[i].prix=panier[i].quantite*panier[i].prixUnitaire; }
      else { panier.splice(i,1); }
      localStorage.setItem('panier',JSON.stringify(panier));
      afficherPanier();
    });
  });
  document.querySelectorAll('.qte-input').forEach(input=>{
    input.addEventListener('change',e=>{
      const i=Number(e.currentTarget.dataset.index);
      if(!Number.isFinite(i)) return;
      let q=Number(e.currentTarget.value); if(isNaN(q)||q<1) q=1; if(q>99) q=99;
      panier[i].quantite=q; panier[i].prix=panier[i].quantite*panier[i].prixUnitaire;
      localStorage.setItem('panier',JSON.stringify(panier));
      afficherPanier();
    });
  });
  document.querySelectorAll('.btn-supprimer').forEach(btn=>{
    btn.addEventListener('click',e=>{
      const i=Number(e.currentTarget.dataset.index);
      if(!Number.isFinite(i)) return;
      panier.splice(i,1);
      localStorage.setItem('panier',JSON.stringify(panier));
      afficherPanier();
    });
  });

  document.getElementById('total').textContent=total.toFixed(2);
  majNbItems();
}

document.getElementById('btn-panier').addEventListener('click',()=>{document.getElementById('sidebar-panier').classList.toggle('open');});
document.getElementById('btn-fermer-panier').addEventListener('click',()=>{document.getElementById('sidebar-panier').classList.remove('open');});

document.getElementById('payer').addEventListener('click', async ()=>{
  if(!panier.length){ alert('Ton panier est vide !'); return; }
  try{
    const response = await fetch('https://www.minipalettes.ca/create-checkout-session',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({panier})
    });
    const data = await response.json();
    if(data.id){
      const stripe = Stripe('pk_live_51RlJVlDmX69ZLUq0eiZ3Vi6R2Nk7SOrHcCQ16fqpmRsWJWULAj4GPRtmYCmRLEJ5X2JW9XfFY3E0ZjA3Jmu0IFmG00Cmh7Km7v');
      await stripe.redirectToCheckout({sessionId:data.id});
    } else { alert('Erreur lors de la cr√©ation de la session de paiement.'); }
  } catch(err){ console.error(err); alert('Erreur lors du paiement.'); }
});

// Affichage produits dans la galerie
function escapeHtml(str){ if(!str) return ''; return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

fetch('produits.json')
  .then(res=>res.json())
  .then(produits=>{
    const galerie=document.getElementById('galerie-produits'); galerie.innerHTML='';
    Object.keys(produits).forEach(id=>{
      const p=produits[id];
      const div=document.createElement('div');
      div.className='produit';
      div.innerHTML=`
        <a href="produit.html?id=${id}" class="lien-produit">
          <img src="${p.image}" alt="${escapeHtml(p.nom)}" />
          <h3>${escapeHtml(p.nom)}</h3>
          <p><strong>${p.prix.toFixed(2)} $</strong></p>
        </a>`;
      galerie.appendChild(div);
    });
  })
  .catch(err=>console.error('Erreur chargement produits.json :',err));

afficherPanier();
majNbItems();
</script>

<div id="footer-container"></div>
<script>
fetch('footer.html').then(res=>res.text()).then(data=>{document.getElementById('footer-container').outerHTML=data;});
</script>

<!-- Pop-up de pause de vente -->
<div id="pause-vente-overlay" style="
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: blur(3px);
  z-index: 9998;
">
</div>

<div id="pause-vente-popup" style="
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%) scale(1);
  background: #fff0f6;
  border: 3px solid #f8bbd0;
  border-radius: 25px;
  padding: 2rem 2.5rem;
  text-align: center;
  box-shadow: 0 8px 20px rgba(0,0,0,0.2);
  z-index: 9999;
  width: min(90%, 400px);
  animation: popIn 0.5s ease forwards;
">
  <h2 style=" color: #c2185b; font-size: 2rem;">Vente temporairement ferm√©e üíï</h2>
  <p style="font-family: sans-serif; color: #555; margin-top: 1rem;">
    La boutique est ferm√©e jusqu'√† la prochaine vente.<br>
    Merci de revenir plus tard !
  </p>
  <button onclick="window.location.href='index.html'" style="
    margin-top: 1.5rem;
    background-color: #c2185b;
    color: white;
    border: none;
    padding: 0.8rem 1.5rem;
    border-radius: 25px;
    cursor: pointer;
    font-weight: bold;
    font-size: 1rem;
    transition: background-color 0.3s;
  " onmouseover="this.style.backgroundColor='#ad1457'" onmouseout="this.style.backgroundColor='#c2185b'">
    Retour au menu principal
  </button>
</div>

<style>
@keyframes popIn {
  from { transform: translate(-50%, -40%) scale(0.9); opacity: 0; }
  to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
}
</style>

<script>
  // ---- CONFIG ----
  const venteEnPause = false; // üü£ METTRE false QUAND LA VENTE EST OUVERTE ::: METTRE true QUAND LA VENTE EST FERM√âE

  if (venteEnPause) {
    // Affiche le pop-up et l‚Äôarri√®re-plan semi-transparent
    document.getElementById('pause-vente-overlay').style.display = 'block';
    document.getElementById('pause-vente-popup').style.display = 'block';

    // Emp√™che toute interaction avec la page derri√®re
    document.body.style.overflow = 'hidden';
    document.querySelector('main').style.pointerEvents = 'none';
    document.querySelector('header').style.pointerEvents = 'none';
    document.querySelector('#btn-panier').style.pointerEvents = 'none';
  }
</script>

</body>
</html>